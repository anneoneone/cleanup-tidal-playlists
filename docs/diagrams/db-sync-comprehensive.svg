<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="3695px" preserveAspectRatio="none" style="width:2598px;height:3695px;background:#FFFFFF;" version="1.1" viewBox="0 0 2598 3695" width="2598px" zoomAndPan="magnify"><title>tidal-cleanup db sync &#8212; Comprehensive Flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="331.1943" x="1129.7351" y="28.5352">tidal-cleanup db sync &#8212; Comprehensive Flow</text><g><title>CLI</title><rect fill="#FFFFFF" height="3446.627" style="stroke:#181818;stroke-width:1;" width="10" x="179.3364" y="150.2871"/></g><g><title>SyncOrchestrator</title><rect fill="#FFFFFF" height="3271.7637" style="stroke:#181818;stroke-width:1;" width="10" x="569.6304" y="325.1504"/></g><g><title>TidalStateFetcher</title><rect fill="#FFFFFF" height="797.6738" style="stroke:#181818;stroke-width:1;" width="10" x="1125.8052" y="440.082"/></g><g><title>FilesystemScanner</title><rect fill="#FFFFFF" height="575.1895" style="stroke:#181818;stroke-width:1;" width="10" x="1355.916" y="1352.6875"/></g><g><title>DeduplicationLogic</title><rect fill="#FFFFFF" height="58.6211" style="stroke:#181818;stroke-width:1;" width="10" x="1566.8823" y="2042.8086"/></g><g><title>SyncDecisionEngine</title><rect fill="#FFFFFF" height="563.1895" style="stroke:#181818;stroke-width:1;" width="10" x="1723.0859" y="2216.3613"/></g><g><title>DownloadOrchestrator</title><rect fill="#FFFFFF" height="515.8789" style="stroke:#181818;stroke-width:1;" width="10" x="2051.8584" y="2894.4824"/></g><rect fill="none" height="607.8105" style="stroke:#000000;stroke-width:1.5;" width="1643.9863" x="737.4009" y="572.3242"/><rect fill="none" height="103.8867" style="stroke:#000000;stroke-width:1.5;" width="593.5151" x="767.4009" y="697.5664"/><rect fill="none" height="357.6816" style="stroke:#000000;stroke-width:1.5;" width="1623.9863" x="747.4009" y="815.4531"/><rect fill="none" height="267.75" style="stroke:#000000;stroke-width:1.5;" width="541.5811" x="757.4009" y="898.3848"/><rect fill="none" height="90.8867" style="stroke:#000000;stroke-width:1.5;" width="438.8857" x="767.4009" y="1023.627"/><rect fill="none" height="502.5684" style="stroke:#000000;stroke-width:1.5;" width="1834.2637" x="737.4009" y="1396.998"/><rect fill="none" height="383.3262" style="stroke:#000000;stroke-width:1.5;" width="833.7197" x="747.4009" y="1509.2402"/><rect fill="none" height="251.084" style="stroke:#000000;stroke-width:1.5;" width="813.7197" x="757.4009" y="1634.4824"/><rect fill="none" height="103.8867" style="stroke:#000000;stroke-width:1.5;" width="720.0386" x="767.4009" y="1774.6797"/><rect fill="none" height="461.2578" style="stroke:#000000;stroke-width:1.5;" width="1472.1689" x="767.4009" y="2289.9824"/><rect fill="none" height="278.3945" style="stroke:#000000;stroke-width:1.5;" width="432.8877" x="1633.9707" y="2415.2246"/><rect fill="none" height="204.7734" style="stroke:#000000;stroke-width:1.5;" width="412.8877" x="1643.9707" y="2481.8457"/><rect fill="none" height="472.5684" style="stroke:#000000;stroke-width:1.5;" width="1824.2637" x="757.4009" y="2909.4824"/><rect fill="none" height="441.2578" style="stroke:#000000;stroke-width:1.5;" width="1804.2637" x="767.4009" y="2933.793"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="19.1826" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="23" x2="23" y1="118.9766" y2="3614.9141"/></g><g><title>CLI</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="180.3364" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="183.6021" x2="183.6021" y1="118.9766" y2="3614.9141"/></g><g><title>SyncOrchestrator</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="570.6304" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="574.4429" x2="574.4429" y1="118.9766" y2="3614.9141"/></g><g><title>DatabaseService</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="835.3994" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="838.4009" x2="838.4009" y1="118.9766" y2="3614.9141"/></g><g><title>TidalStateFetcher</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="1126.8052" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1130.3237" x2="1130.3237" y1="118.9766" y2="3614.9141"/></g><g><title>FilesystemScanner</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="1356.916" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1360.6953" x2="1360.6953" y1="118.9766" y2="3614.9141"/></g><g><title>DeduplicationLogic</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="1567.8823" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1571.7939" x2="1571.7939" y1="118.9766" y2="3614.9141"/></g><g><title>SyncDecisionEngine</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="1724.0859" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1727.9707" x2="1727.9707" y1="118.9766" y2="3614.9141"/></g><g><title>DownloadOrchestrator</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="2052.8584" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="2056.1523" x2="2056.1523" y1="118.9766" y2="3614.9141"/></g><g><title>Tidal API</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="2320.7124" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="2324.0376" x2="2324.0376" y1="118.9766" y2="3614.9141"/></g><g><title>tidal-dl-ng</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="2412.5625" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="2416.3872" x2="2416.3872" y1="118.9766" y2="3614.9141"/></g><g><title>File System</title><rect fill="#000000" fill-opacity="0.00000" height="3495.9375" width="8" x="2512.7012" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="2515.7378" x2="2515.7378" y1="118.9766" y2="3614.9141"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.3652" x="5" y="116.0234">User</text><ellipse cx="23.1826" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.1826,58.9883 L23.1826,85.9883 M10.1826,66.9883 L36.1826,66.9883 M23.1826,85.9883 L10.1826,100.9883 M23.1826,85.9883 L36.1826,100.9883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.3652" x="5" y="3627.4492">User</text><ellipse cx="23.1826" cy="3638.9023" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.1826,3646.9023 L23.1826,3673.9023 M10.1826,3654.9023 L36.1826,3654.9023 M23.1826,3673.9023 L10.1826,3688.9023 M23.1826,3673.9023 L36.1826,3688.9023" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="CLI"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.4688" x="146.6021" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21.1846" x="173.7441" y="91.5352">CLI</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.4688" x="153.6021" y="108.0234">(db sync)</text></g><g class="participant participant-tail" data-participant="CLI"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.4688" x="146.6021" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="21.1846" x="173.7441" y="3634.4492">CLI</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.4688" x="153.6021" y="3650.9375">(db sync)</text></g><g class="participant participant-head" data-participant="Orch"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.375" x="509.4429" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.375" x="516.4429" y="108.0234">SyncOrchestrator</text></g><g class="participant participant-tail" data-participant="Orch"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.375" x="509.4429" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.375" x="516.4429" y="3634.4492">SyncOrchestrator</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.9971" x="777.4009" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.9971" x="784.4009" y="108.0234">DatabaseService</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.9971" x="777.4009" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.9971" x="784.4009" y="3634.4492">DatabaseService</text></g><g class="participant participant-head" data-participant="Fetcher"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.9629" x="1065.3237" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.9629" x="1072.3237" y="108.0234">TidalStateFetcher</text></g><g class="participant participant-tail" data-participant="Fetcher"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.9629" x="1065.3237" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.9629" x="1072.3237" y="3634.4492">TidalStateFetcher</text></g><g class="participant participant-head" data-participant="Scanner"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.4414" x="1291.6953" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.4414" x="1298.6953" y="108.0234">FilesystemScanner</text></g><g class="participant participant-tail" data-participant="Scanner"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="138.4414" x="1291.6953" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.4414" x="1298.6953" y="3634.4492">FilesystemScanner</text></g><g class="participant participant-head" data-participant="Dedup"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144.1768" x="1499.7939" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.1768" x="1506.7939" y="108.0234">DeduplicationLogic</text></g><g class="participant participant-tail" data-participant="Dedup"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="144.1768" x="1499.7939" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130.1768" x="1506.7939" y="3634.4492">DeduplicationLogic</text></g><g class="participant participant-head" data-participant="Engine"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148.2305" x="1653.9707" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134.2305" x="1660.9707" y="108.0234">SyncDecisionEngine</text></g><g class="participant participant-tail" data-participant="Engine"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="148.2305" x="1653.9707" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134.2305" x="1660.9707" y="3634.4492">SyncDecisionEngine</text></g><g class="participant participant-head" data-participant="Exec"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="167.4121" x="1973.1523" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.4121" x="1980.1523" y="108.0234">DownloadOrchestrator</text></g><g class="participant participant-tail" data-participant="Exec"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="167.4121" x="1973.1523" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.4121" x="1980.1523" y="3634.4492">DownloadOrchestrator</text></g><g class="participant participant-head" data-participant="TidalAPI"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.3496" x="2288.0376" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3496" x="2295.0376" y="108.0234">Tidal API</text></g><g class="participant participant-tail" data-participant="TidalAPI"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.3496" x="2288.0376" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.3496" x="2295.0376" y="3634.4492">Tidal API</text></g><g class="participant participant-head" data-participant="TidalDL"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.3506" x="2371.3872" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.3506" x="2378.3872" y="108.0234">tidal-dl-ng</text></g><g class="participant participant-tail" data-participant="TidalDL"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90.3506" x="2371.3872" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.3506" x="2378.3872" y="3634.4492">tidal-dl-ng</text></g><g class="participant participant-head" data-participant="FS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89.9268" x="2471.7378" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.9268" x="2478.7378" y="108.0234">File System</text></g><g class="participant participant-tail" data-participant="FS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89.9268" x="2471.7378" y="3613.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.9268" x="2478.7378" y="3634.4492">File System</text></g><g><title>CLI</title><rect fill="#FFFFFF" height="3446.627" style="stroke:#181818;stroke-width:1;" width="10" x="179.3364" y="150.2871"/></g><g><title>SyncOrchestrator</title><rect fill="#FFFFFF" height="3271.7637" style="stroke:#181818;stroke-width:1;" width="10" x="569.6304" y="325.1504"/></g><g><title>TidalStateFetcher</title><rect fill="#FFFFFF" height="797.6738" style="stroke:#181818;stroke-width:1;" width="10" x="1125.8052" y="440.082"/></g><g><title>FilesystemScanner</title><rect fill="#FFFFFF" height="575.1895" style="stroke:#181818;stroke-width:1;" width="10" x="1355.916" y="1352.6875"/></g><g><title>DeduplicationLogic</title><rect fill="#FFFFFF" height="58.6211" style="stroke:#181818;stroke-width:1;" width="10" x="1566.8823" y="2042.8086"/></g><g><title>SyncDecisionEngine</title><rect fill="#FFFFFF" height="563.1895" style="stroke:#181818;stroke-width:1;" width="10" x="1723.0859" y="2216.3613"/></g><g><title>DownloadOrchestrator</title><rect fill="#FFFFFF" height="515.8789" style="stroke:#181818;stroke-width:1;" width="10" x="2051.8584" y="2894.4824"/></g><g class="message" data-participant-1="User" data-participant-2="CLI"><polygon fill="#181818" points="167.3364,146.2871,177.3364,150.2871,167.3364,154.2871,171.3364,150.2871" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="23.1826" x2="173.3364" y1="150.2871" y2="150.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.1538" x="30.1826" y="145.5449">tidal-cleanup db sync</text></g><g class="message" data-participant-1="CLI" data-participant-2="CLI"><line style="stroke:#181818;stroke-width:1;" x1="189.3364" x2="231.3364" y1="179.5977" y2="179.5977"/><line style="stroke:#181818;stroke-width:1;" x1="231.3364" x2="231.3364" y1="179.5977" y2="192.5977"/><line style="stroke:#181818;stroke-width:1;" x1="190.3364" x2="231.3364" y1="192.5977" y2="192.5977"/><polygon fill="#181818" points="200.3364,188.5977,190.3364,192.5977,200.3364,196.5977,196.3364,192.5977" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.6118" x="196.3364" y="174.8555">Parse options, init Config</text></g><g class="message" data-participant-1="CLI" data-participant-2="DB"><polygon fill="#181818" points="827.3994,217.9082,837.3994,221.9082,827.3994,225.9082,831.3994,221.9082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="189.3364" x2="833.3994" y1="221.9082" y2="221.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.751" x="196.3364" y="217.166">DatabaseService(db_path)</text></g><g class="message" data-participant-1="CLI" data-participant-2="TidalAPI"><polygon fill="#181818" points="2312.7124,247.2188,2322.7124,251.2188,2312.7124,255.2188,2316.7124,251.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="189.3364" x2="2318.7124" y1="251.2188" y2="251.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.8794" x="196.3364" y="246.4766">Connect</text></g><g class="message" data-participant-1="CLI" data-participant-2="TidalDL"><polygon fill="#181818" points="2404.5625,276.5293,2414.5625,280.5293,2404.5625,284.5293,2408.5625,280.5293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="189.3364" x2="2410.5625" y1="280.5293" y2="280.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51.8794" x="196.3364" y="275.7871">Connect</text></g><g class="message" data-participant-1="CLI" data-participant-2="Orch"><polygon fill="#181818" points="557.6304,321.1504,567.6304,325.1504,557.6304,329.1504,561.6304,325.1504" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="189.3364" x2="563.6304" y1="325.1504" y2="325.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.8667" x="196.3364" y="305.0977">new SyncOrchestrator(config, db_service,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.061" x="200.4497" y="320.4082">download_service, tidal_session)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2591.6646" x="0" y="353.8057"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="353.8057" y2="353.8057"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="356.8057" y2="356.8057"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="185.4375" x="1203.1135" y="343.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="167.1528" x="1209.1135" y="359.7188">Stage 1: Fetch from Tidal</text><g class="message" data-participant-1="Orch" data-participant-2="Orch"><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="621.6304" y1="397.7715" y2="397.7715"/><line style="stroke:#181818;stroke-width:1;" x1="621.6304" x2="621.6304" y1="397.7715" y2="410.7715"/><line style="stroke:#181818;stroke-width:1;" x1="580.6304" x2="621.6304" y1="410.7715" y2="410.7715"/><polygon fill="#181818" points="590.6304,406.7715,580.6304,410.7715,590.6304,414.7715,586.6304,410.7715" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.0093" x="586.6304" y="393.0293">_execute_tidal_fetch_step()</text></g><g class="message" data-participant-1="Orch" data-participant-2="Fetcher"><polygon fill="#181818" points="1113.8052,436.082,1123.8052,440.082,1113.8052,444.082,1117.8052,440.082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="1119.8052" y1="440.082" y2="440.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.3042" x="586.6304" y="435.3398">fetch_all_playlists()</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,465.3926,840.3994,469.3926,850.3994,473.3926,846.3994,469.3926" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="469.3926" y2="469.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.8213" x="856.3994" y="464.6504">get_last_sync_timestamp("tidal_sync")</text></g><g class="message" data-participant-1="DB" data-participant-2="Fetcher"><polygon fill="#181818" points="1113.8052,494.7031,1123.8052,498.7031,1113.8052,502.7031,1117.8052,498.7031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1119.8052" y1="498.7031" y2="498.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.5713" x="846.3994" y="493.9609">last_sync_time</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="TidalAPI"><polygon fill="#181818" points="2312.7124,524.0137,2322.7124,528.0137,2312.7124,532.0137,2316.7124,528.0137" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1135.8052" x2="2318.7124" y1="528.0137" y2="528.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.416" x="1142.8052" y="523.2715">session.user.playlists()</text></g><g class="message" data-participant-1="TidalAPI" data-participant-2="Fetcher"><polygon fill="#181818" points="1146.8052,553.3242,1136.8052,557.3242,1146.8052,561.3242,1142.8052,557.3242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1140.8052" x2="2323.7124" y1="557.3242" y2="557.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.2373" x="1152.8052" y="552.582">tidal_playlists[]</text></g><path d="M737.4009,572.3242 L811.8477,572.3242 L811.8477,579.6348 L801.8477,589.6348 L737.4009,589.6348 L737.4009,572.3242" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="607.8105" style="stroke:#000000;stroke-width:1.5;" width="1643.9863" x="737.4009" y="572.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="752.4009" y="585.8926">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="132.1826" x="826.8477" y="584.959">[For each tidal_playlist]</text><g class="message" data-participant-1="Fetcher" data-participant-2="Fetcher"><line style="stroke:#181818;stroke-width:1;" x1="1135.8052" x2="1177.8052" y1="610.9453" y2="610.9453"/><line style="stroke:#181818;stroke-width:1;" x1="1177.8052" x2="1177.8052" y1="610.9453" y2="623.9453"/><line style="stroke:#181818;stroke-width:1;" x1="1136.8052" x2="1177.8052" y1="623.9453" y2="623.9453"/><polygon fill="#181818" points="1146.8052,619.9453,1136.8052,623.9453,1146.8052,627.9453,1142.8052,623.9453" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.4751" x="1142.8052" y="606.2031">_convert_tidal_playlist()</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,649.2559,840.3994,653.2559,850.3994,657.2559,846.3994,653.2559" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="653.2559" y2="653.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.4146" x="856.3994" y="648.5137">get_playlist_by_tidal_id(tidal_id)</text></g><g class="message" data-participant-1="DB" data-participant-2="Fetcher"><polygon fill="#181818" points="1113.8052,678.5664,1123.8052,682.5664,1113.8052,686.5664,1117.8052,682.5664" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1119.8052" y1="682.5664" y2="682.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55.8784" x="846.3994" y="677.8242">existing?</text></g><path d="M767.4009,697.5664 L829.5396,697.5664 L829.5396,704.877 L819.5396,714.877 L767.4009,714.877 L767.4009,697.5664" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="103.8867" style="stroke:#000000;stroke-width:1.5;" width="593.5151" x="767.4009" y="697.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="782.4009" y="711.1348">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41.7334" x="844.5396" y="710.2012">[Exists]</text><g class="message" data-participant-1="Fetcher" data-participant-2="Fetcher"><line style="stroke:#181818;stroke-width:1;" x1="1135.8052" x2="1177.8052" y1="736.1875" y2="736.1875"/><line style="stroke:#181818;stroke-width:1;" x1="1177.8052" x2="1177.8052" y1="736.1875" y2="749.1875"/><line style="stroke:#181818;stroke-width:1;" x1="1136.8052" x2="1177.8052" y1="749.1875" y2="749.1875"/><polygon fill="#181818" points="1146.8052,745.1875,1136.8052,749.1875,1146.8052,753.1875,1142.8052,749.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.1108" x="1142.8052" y="731.4453">_update_playlist(existing, data)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="767.4009" x2="1360.916" y1="758.1875" y2="758.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="32.5435" x="772.4009" y="768.8223">[New]</text><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,789.4531,840.3994,793.4531,850.3994,797.4531,846.3994,793.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="793.4531" y2="793.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.7788" x="856.3994" y="788.7109">create_playlist(data)</text></g><path d="M747.4009,815.4531 L809.5396,815.4531 L809.5396,822.7637 L799.5396,832.7637 L747.4009,832.7637 L747.4009,815.4531" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="357.6816" style="stroke:#000000;stroke-width:1.5;" width="1623.9863" x="747.4009" y="815.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="762.4009" y="829.0215">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="117.5303" x="824.5396" y="828.0879">[Should fetch tracks]</text><g class="message" data-participant-1="Fetcher" data-participant-2="TidalAPI"><polygon fill="#181818" points="2312.7124,850.0742,2322.7124,854.0742,2312.7124,858.0742,2316.7124,854.0742" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1135.8052" x2="2318.7124" y1="854.0742" y2="854.0742"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.9683" x="1142.8052" y="849.332">tidal_playlist.tracks()</text></g><g class="message" data-participant-1="TidalAPI" data-participant-2="Fetcher"><polygon fill="#181818" points="1146.8052,879.3848,1136.8052,883.3848,1146.8052,887.3848,1142.8052,883.3848" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1140.8052" x2="2323.7124" y1="883.3848" y2="883.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.939" x="1152.8052" y="878.6426">tidal_tracks[]</text></g><path d="M757.4009,898.3848 L831.8477,898.3848 L831.8477,905.6953 L821.8477,915.6953 L757.4009,915.6953 L757.4009,898.3848" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="267.75" style="stroke:#000000;stroke-width:1.5;" width="541.5811" x="757.4009" y="898.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="772.4009" y="911.9531">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119.3457" x="846.8477" y="911.0195">[For each tidal_track]</text><g class="message" data-participant-1="Fetcher" data-participant-2="Fetcher"><line style="stroke:#181818;stroke-width:1;" x1="1135.8052" x2="1177.8052" y1="937.0059" y2="937.0059"/><line style="stroke:#181818;stroke-width:1;" x1="1177.8052" x2="1177.8052" y1="937.0059" y2="950.0059"/><line style="stroke:#181818;stroke-width:1;" x1="1136.8052" x2="1177.8052" y1="950.0059" y2="950.0059"/><polygon fill="#181818" points="1146.8052,946.0059,1136.8052,950.0059,1146.8052,954.0059,1142.8052,950.0059" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.1768" x="1142.8052" y="932.2637">_convert_tidal_track()</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,975.3164,840.3994,979.3164,850.3994,983.3164,846.3994,979.3164" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="979.3164" y2="979.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.1162" x="856.3994" y="974.5742">get_track_by_tidal_id(tidal_id)</text></g><g class="message" data-participant-1="DB" data-participant-2="Fetcher"><polygon fill="#181818" points="1113.8052,1004.627,1123.8052,1008.627,1113.8052,1012.627,1117.8052,1008.627" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1119.8052" y1="1008.627" y2="1008.627"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59.9663" x="846.3994" y="1003.8848">db_track?</text></g><path d="M767.4009,1023.627 L829.5396,1023.627 L829.5396,1030.9375 L819.5396,1040.9375 L767.4009,1040.9375 L767.4009,1023.627" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="90.8867" style="stroke:#000000;stroke-width:1.5;" width="438.8857" x="767.4009" y="1023.627"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="782.4009" y="1037.1953">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="41.7334" x="844.5396" y="1036.2617">[Exists]</text><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1058.248,840.3994,1062.248,850.3994,1066.248,846.3994,1062.248" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="1062.248" y2="1062.248"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.6919" x="856.3994" y="1057.5059">update_track(data)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="767.4009" x2="1206.2866" y1="1071.248" y2="1071.248"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="32.5435" x="772.4009" y="1081.8828">[New]</text><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1102.5137,840.3994,1106.5137,850.3994,1110.5137,846.3994,1106.5137" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="1106.5137" y2="1106.5137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.4805" x="856.3994" y="1101.7715">create_track(data)</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1154.1348,840.3994,1158.1348,850.3994,1162.1348,846.3994,1158.1348" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="1158.1348" y2="1158.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262.4058" x="856.3994" y="1138.082">add_track_to_playlist(playlist_id, track_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.9287" x="860.5127" y="1153.3926">position, in_tidal=True)</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1204.4453,840.3994,1208.4453,850.3994,1212.4453,846.3994,1208.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1124.8052" y1="1208.4453" y2="1208.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.5396" x="856.3994" y="1203.7031">create_snapshot("tidal_sync", stats)</text></g><g class="message" data-participant-1="Fetcher" data-participant-2="Orch"><polygon fill="#181818" points="590.6304,1233.7559,580.6304,1237.7559,590.6304,1241.7559,586.6304,1237.7559" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="584.6304" x2="1129.8052" y1="1237.7559" y2="1237.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.9971" x="596.6304" y="1233.0137">FetchStatistics</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2591.6646" x="0" y="1266.4111"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="1266.4111" y2="1266.4111"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="1269.4111" y2="1269.4111"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="181.2925" x="1205.186" y="1255.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163.0078" x="1211.186" y="1272.3242">Stage 2: Scan Filesystem</text><g class="message" data-participant-1="Orch" data-participant-2="Orch"><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="621.6304" y1="1310.377" y2="1310.377"/><line style="stroke:#181818;stroke-width:1;" x1="621.6304" x2="621.6304" y1="1310.377" y2="1323.377"/><line style="stroke:#181818;stroke-width:1;" x1="580.6304" x2="621.6304" y1="1323.377" y2="1323.377"/><polygon fill="#181818" points="590.6304,1319.377,580.6304,1323.377,590.6304,1327.377,586.6304,1323.377" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.0171" x="586.6304" y="1305.6348">_execute_filesystem_scan_step()</text></g><g class="message" data-participant-1="Orch" data-participant-2="Scanner"><polygon fill="#181818" points="1343.916,1348.6875,1353.916,1352.6875,1343.916,1356.6875,1347.916,1352.6875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="1349.916" y1="1352.6875" y2="1352.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.2256" x="586.6304" y="1347.9453">scan_all_playlists()</text></g><g class="message" data-participant-1="Scanner" data-participant-2="FS"><polygon fill="#181818" points="2504.7012,1377.998,2514.7012,1381.998,2504.7012,1385.998,2508.7012,1381.998" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1365.916" x2="2510.7012" y1="1381.998" y2="1381.998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.5449" x="1372.916" y="1377.2559">List Playlists/ directories and files</text></g><path d="M737.4009,1396.998 L811.8477,1396.998 L811.8477,1404.3086 L801.8477,1414.3086 L737.4009,1414.3086 L737.4009,1396.998" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="502.5684" style="stroke:#000000;stroke-width:1.5;" width="1834.2637" x="737.4009" y="1396.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="752.4009" y="1410.5664">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="122.6812" x="826.8477" y="1409.6328">[For each playlist_dir]</text><g class="message" data-participant-1="Scanner" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1431.6191,840.3994,1435.6191,850.3994,1439.6191,846.3994,1435.6191" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1354.916" y1="1435.6191" y2="1435.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.3091" x="856.3994" y="1430.877">get_playlist_by_name(name)</text></g><g class="message" data-participant-1="DB" data-participant-2="Scanner"><polygon fill="#181818" points="1343.916,1460.9297,1353.916,1464.9297,1343.916,1468.9297,1347.916,1464.9297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1349.916" y1="1464.9297" y2="1464.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44.916" x="846.3994" y="1460.1875">playlist</text></g><g class="message" data-participant-1="Scanner" data-participant-2="FS"><polygon fill="#181818" points="2504.7012,1490.2402,2514.7012,1494.2402,2504.7012,1498.2402,2508.7012,1494.2402" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1365.916" x2="2510.7012" y1="1494.2402" y2="1494.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.7754" x="1372.916" y="1489.498">List audio files (*.mp3, *.flac, ...)</text></g><path d="M747.4009,1509.2402 L821.8477,1509.2402 L821.8477,1516.5508 L811.8477,1526.5508 L747.4009,1526.5508 L747.4009,1509.2402" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="383.3262" style="stroke:#000000;stroke-width:1.5;" width="833.7197" x="747.4009" y="1509.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="762.4009" y="1522.8086">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="77.897" x="836.8477" y="1521.875">[For each file]</text><g class="message" data-participant-1="Scanner" data-participant-2="Scanner"><line style="stroke:#181818;stroke-width:1;" x1="1365.916" x2="1407.916" y1="1547.8613" y2="1547.8613"/><line style="stroke:#181818;stroke-width:1;" x1="1407.916" x2="1407.916" y1="1547.8613" y2="1560.8613"/><line style="stroke:#181818;stroke-width:1;" x1="1366.916" x2="1407.916" y1="1560.8613" y2="1560.8613"/><polygon fill="#181818" points="1376.916,1556.8613,1366.916,1560.8613,1376.916,1564.8613,1372.916,1560.8613" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.9663" x="1372.916" y="1543.1191">Parse filename &#8594; artist/title</text></g><g class="message" data-participant-1="Scanner" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1586.1719,840.3994,1590.1719,850.3994,1594.1719,846.3994,1590.1719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1354.916" y1="1590.1719" y2="1590.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.0933" x="856.3994" y="1585.4297">find_track_by_normalized_name("artist - title")</text></g><g class="message" data-participant-1="DB" data-participant-2="Scanner"><polygon fill="#181818" points="1343.916,1615.4824,1353.916,1619.4824,1343.916,1623.4824,1347.916,1619.4824" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1349.916" y1="1619.4824" y2="1619.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37.1021" x="846.3994" y="1614.7402">track?</text></g><path d="M757.4009,1634.4824 L819.5396,1634.4824 L819.5396,1641.793 L809.5396,1651.793 L757.4009,1651.793 L757.4009,1634.4824" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="251.084" style="stroke:#000000;stroke-width:1.5;" width="813.7197" x="757.4009" y="1634.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="772.4009" y="1648.0508">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="43.2319" x="834.5396" y="1647.1172">[Found]</text><g class="message" data-participant-1="Scanner" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1669.1035,840.3994,1673.1035,850.3994,1677.1035,846.3994,1673.1035" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1354.916" y1="1673.1035" y2="1673.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.689" x="856.3994" y="1668.3613">add_file_path_to_track(track_id, rel_path)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="757.4009" x2="1571.1206" y1="1682.1035" y2="1682.1035"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65.0386" x="762.4009" y="1692.7383">[Not found]</text><g class="message" data-participant-1="Scanner" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1713.3691,840.3994,1717.3691,850.3994,1721.3691,846.3994,1717.3691" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1354.916" y1="1717.3691" y2="1717.3691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.6055" x="856.3994" y="1712.627">get_all_tracks()</text></g><g class="message" data-participant-1="Scanner" data-participant-2="Scanner"><line style="stroke:#181818;stroke-width:1;" x1="1365.916" x2="1407.916" y1="1746.6797" y2="1746.6797"/><line style="stroke:#181818;stroke-width:1;" x1="1407.916" x2="1407.916" y1="1746.6797" y2="1759.6797"/><line style="stroke:#181818;stroke-width:1;" x1="1366.916" x2="1407.916" y1="1759.6797" y2="1759.6797"/><polygon fill="#181818" points="1376.916,1755.6797,1366.916,1759.6797,1376.916,1763.6797,1372.916,1759.6797" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.2046" x="1372.916" y="1741.9375">Fuzzy match best candidate</text></g><path d="M767.4009,1774.6797 L829.5396,1774.6797 L829.5396,1781.9902 L819.5396,1791.9902 L767.4009,1791.9902 L767.4009,1774.6797" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="103.8867" style="stroke:#000000;stroke-width:1.5;" width="720.0386" x="767.4009" y="1774.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="782.4009" y="1788.248">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="79.0894" x="844.5396" y="1787.3145">[Match found]</text><g class="message" data-participant-1="Scanner" data-participant-2="DB"><polygon fill="#181818" points="850.3994,1809.3008,840.3994,1813.3008,850.3994,1817.3008,846.3994,1813.3008" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1354.916" y1="1813.3008" y2="1813.3008"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.689" x="856.3994" y="1808.5586">add_file_path_to_track(track_id, rel_path)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="767.4009" x2="1487.4395" y1="1822.3008" y2="1822.3008"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="72.1982" x="772.4009" y="1832.9355">[Orphan file]</text><g class="message" data-participant-1="Scanner" data-participant-2="Scanner"><line style="stroke:#181818;stroke-width:1;" x1="1365.916" x2="1407.916" y1="1857.5664" y2="1857.5664"/><line style="stroke:#181818;stroke-width:1;" x1="1407.916" x2="1407.916" y1="1857.5664" y2="1870.5664"/><line style="stroke:#181818;stroke-width:1;" x1="1366.916" x2="1407.916" y1="1870.5664" y2="1870.5664"/><polygon fill="#181818" points="1376.916,1866.5664,1366.916,1870.5664,1376.916,1874.5664,1372.916,1870.5664" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.5234" x="1372.916" y="1852.8242">Record orphan</text></g><g class="message" data-participant-1="Scanner" data-participant-2="Orch"><polygon fill="#181818" points="590.6304,1923.877,580.6304,1927.877,590.6304,1931.877,586.6304,1927.877" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="584.6304" x2="1359.916" y1="1927.877" y2="1927.877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.103" x="596.6304" y="1923.1348">ScanStatistics</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2591.6646" x="0" y="1956.5322"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="1956.5322" y2="1956.5322"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="1959.5322" y2="1959.5322"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="225.3579" x="1183.1533" y="1945.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="207.0732" x="1189.1533" y="1962.4453">Stage 3: Analyze Deduplication</text><g class="message" data-participant-1="Orch" data-participant-2="Orch"><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="621.6304" y1="2000.498" y2="2000.498"/><line style="stroke:#181818;stroke-width:1;" x1="621.6304" x2="621.6304" y1="2000.498" y2="2013.498"/><line style="stroke:#181818;stroke-width:1;" x1="580.6304" x2="621.6304" y1="2013.498" y2="2013.498"/><polygon fill="#181818" points="590.6304,2009.498,580.6304,2013.498,590.6304,2017.498,586.6304,2013.498" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.0425" x="586.6304" y="1995.7559">_execute_deduplication_step()</text></g><g class="message" data-participant-1="Orch" data-participant-2="Dedup"><polygon fill="#181818" points="1554.8823,2038.8086,1564.8823,2042.8086,1554.8823,2046.8086,1558.8823,2042.8086" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="1560.8823" y1="2042.8086" y2="2042.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.0654" x="586.6304" y="2038.0664">analyze_all_tracks()</text></g><g class="message" data-participant-1="Dedup" data-participant-2="DB"><polygon fill="#181818" points="850.3994,2068.1191,840.3994,2072.1191,850.3994,2076.1191,846.3994,2072.1191" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1565.8823" y1="2072.1191" y2="2072.1191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.4526" x="856.3994" y="2067.377">Inspect track distributions across playlists</text></g><g class="message" data-participant-1="Dedup" data-participant-2="Orch"><polygon fill="#181818" points="590.6304,2097.4297,580.6304,2101.4297,590.6304,2105.4297,586.6304,2101.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="584.6304" x2="1570.8823" y1="2101.4297" y2="2101.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.2168" x="596.6304" y="2096.6875">DeduplicationResult</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2591.6646" x="0" y="2130.085"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="2130.085" y2="2130.085"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="2133.085" y2="2133.085"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="204.2012" x="1193.7317" y="2119.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="185.9165" x="1199.7317" y="2135.998">Stage 4: Generate Decisions</text><g class="message" data-participant-1="Orch" data-participant-2="Orch"><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="621.6304" y1="2174.0508" y2="2174.0508"/><line style="stroke:#181818;stroke-width:1;" x1="621.6304" x2="621.6304" y1="2174.0508" y2="2187.0508"/><line style="stroke:#181818;stroke-width:1;" x1="580.6304" x2="621.6304" y1="2187.0508" y2="2187.0508"/><polygon fill="#181818" points="590.6304,2183.0508,580.6304,2187.0508,590.6304,2191.0508,586.6304,2187.0508" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.769" x="586.6304" y="2169.3086">_execute_decision_generation_step()</text></g><g class="message" data-participant-1="Orch" data-participant-2="Engine"><polygon fill="#181818" points="1711.0859,2212.3613,1721.0859,2216.3613,1711.0859,2220.3613,1715.0859,2216.3613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="1717.0859" y1="2216.3613" y2="2216.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.3638" x="586.6304" y="2211.6191">analyze_all_playlists()</text></g><g class="message" data-participant-1="Engine" data-participant-2="DB"><polygon fill="#181818" points="850.3994,2241.6719,840.3994,2245.6719,850.3994,2249.6719,846.3994,2245.6719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1722.0859" y1="2245.6719" y2="2245.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.9038" x="856.3994" y="2240.9297">get_all_playlists()</text></g><g class="message" data-participant-1="DB" data-participant-2="Engine"><polygon fill="#181818" points="1711.0859,2270.9824,1721.0859,2274.9824,1711.0859,2278.9824,1715.0859,2274.9824" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1717.0859" y1="2274.9824" y2="2274.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59.998" x="846.3994" y="2270.2402">playlists[]</text></g><path d="M767.4009,2289.9824 L841.8477,2289.9824 L841.8477,2297.293 L831.8477,2307.293 L767.4009,2307.293 L767.4009,2289.9824" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="461.2578" style="stroke:#000000;stroke-width:1.5;" width="1472.1689" x="767.4009" y="2289.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="782.4009" y="2303.5508">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="101.3149" x="856.8477" y="2302.6172">[For each playlist]</text><g class="message" data-participant-1="Engine" data-participant-2="DB"><polygon fill="#181818" points="850.3994,2324.6035,840.3994,2328.6035,850.3994,2332.6035,846.3994,2328.6035" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="1722.0859" y1="2328.6035" y2="2328.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.3701" x="856.3994" y="2323.8613">get_playlist_track_associations(playlist_id)</text></g><g class="message" data-participant-1="DB" data-participant-2="Engine"><polygon fill="#181818" points="1711.0859,2353.9141,1721.0859,2357.9141,1711.0859,2361.9141,1715.0859,2357.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="1717.0859" y1="2357.9141" y2="2357.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.1157" x="846.3994" y="2353.1719">playlist_tracks[]</text></g><g class="message" data-participant-1="Engine" data-participant-2="Engine"><line style="stroke:#181818;stroke-width:1;" x1="1733.0859" x2="1775.0859" y1="2387.2246" y2="2387.2246"/><line style="stroke:#181818;stroke-width:1;" x1="1775.0859" x2="1775.0859" y1="2387.2246" y2="2400.2246"/><line style="stroke:#181818;stroke-width:1;" x1="1734.0859" x2="1775.0859" y1="2400.2246" y2="2400.2246"/><polygon fill="#181818" points="1744.0859,2396.2246,1734.0859,2400.2246,1744.0859,2404.2246,1740.0859,2400.2246" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.6421" x="1740.0859" y="2382.4824">_collect_active_playlist_paths()</text></g><path d="M1633.9707,2415.2246 L1708.4175,2415.2246 L1708.4175,2422.5352 L1698.4175,2432.5352 L1633.9707,2432.5352 L1633.9707,2415.2246" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="278.3945" style="stroke:#000000;stroke-width:1.5;" width="432.8877" x="1633.9707" y="2415.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="1648.9707" y="2428.793">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="135.5557" x="1723.4175" y="2427.8594">[For each playlist_track]</text><g class="message" data-participant-1="Engine" data-participant-2="Engine"><line style="stroke:#181818;stroke-width:1;" x1="1733.0859" x2="1775.0859" y1="2453.8457" y2="2453.8457"/><line style="stroke:#181818;stroke-width:1;" x1="1775.0859" x2="1775.0859" y1="2453.8457" y2="2466.8457"/><line style="stroke:#181818;stroke-width:1;" x1="1734.0859" x2="1775.0859" y1="2466.8457" y2="2466.8457"/><polygon fill="#181818" points="1744.0859,2462.8457,1734.0859,2466.8457,1744.0859,2470.8457,1740.0859,2466.8457" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.5527" x="1740.0859" y="2449.1035">_find_existing_track_file(playlist, track)</text></g><path d="M1643.9707,2481.8457 L1706.1094,2481.8457 L1706.1094,2489.1563 L1696.1094,2499.1563 L1643.9707,2499.1563 L1643.9707,2481.8457" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="204.7734" style="stroke:#000000;stroke-width:1.5;" width="412.8877" x="1643.9707" y="2481.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="1658.9707" y="2495.4141">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="187.7466" x="1721.1094" y="2494.4805">[Track not in Tidal &amp;&amp; file exists]</text><g class="message" data-participant-1="Engine" data-participant-2="Engine"><line style="stroke:#181818;stroke-width:1;" x1="1733.0859" x2="1775.0859" y1="2535.7773" y2="2535.7773"/><line style="stroke:#181818;stroke-width:1;" x1="1775.0859" x2="1775.0859" y1="2535.7773" y2="2548.7773"/><line style="stroke:#181818;stroke-width:1;" x1="1734.0859" x2="1775.0859" y1="2548.7773" y2="2548.7773"/><polygon fill="#181818" points="1744.0859,2544.7773,1734.0859,2548.7773,1744.0859,2552.7773,1740.0859,2548.7773" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.3613" x="1740.0859" y="2515.7246">Decision: REMOVE_FILE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.2422" x="1740.0859" y="2531.0352">(reason: removed from Tidal, priority=8)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1643.9707" x2="2056.8584" y1="2557.7773" y2="2557.7773"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="117.3745" x="1648.9707" y="2568.4121">[File exists at target]</text><g class="message" data-participant-1="Engine" data-participant-2="Engine"><line style="stroke:#181818;stroke-width:1;" x1="1733.0859" x2="1775.0859" y1="2593.043" y2="2593.043"/><line style="stroke:#181818;stroke-width:1;" x1="1775.0859" x2="1775.0859" y1="2593.043" y2="2606.043"/><line style="stroke:#181818;stroke-width:1;" x1="1734.0859" x2="1775.0859" y1="2606.043" y2="2606.043"/><polygon fill="#181818" points="1744.0859,2602.043,1734.0859,2606.043,1744.0859,2610.043,1740.0859,2606.043" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.8965" x="1740.0859" y="2588.3008">Decision: NO_ACTION</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1643.9707" x2="2056.8584" y1="2615.043" y2="2615.043"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="196.48" x="1648.9707" y="2625.6777">[File missing or needed in playlist]</text><g class="message" data-participant-1="Engine" data-participant-2="Engine"><line style="stroke:#181818;stroke-width:1;" x1="1733.0859" x2="1775.0859" y1="2665.6191" y2="2665.6191"/><line style="stroke:#181818;stroke-width:1;" x1="1775.0859" x2="1775.0859" y1="2665.6191" y2="2678.6191"/><line style="stroke:#181818;stroke-width:1;" x1="1734.0859" x2="1775.0859" y1="2678.6191" y2="2678.6191"/><polygon fill="#181818" points="1744.0859,2674.6191,1734.0859,2678.6191,1744.0859,2682.6191,1740.0859,2678.6191" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.751" x="1740.0859" y="2645.5664">Decision: DOWNLOAD_TRACK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.7725" x="1740.0859" y="2660.877">(target: Playlists/Artist - Title.ext, priority=10)</text></g><g class="message" data-participant-1="Engine" data-participant-2="Engine"><line style="stroke:#181818;stroke-width:1;" x1="1733.0859" x2="1775.0859" y1="2726.085" y2="2726.085"/><line style="stroke:#181818;stroke-width:1;" x1="1775.0859" x2="1775.0859" y1="2726.085" y2="2739.085"/><line style="stroke:#181818;stroke-width:1;" x1="1734.0859" x2="1775.0859" y1="2739.085" y2="2739.085"/><polygon fill="#181818" points="1744.0859,2735.085,1734.0859,2739.085,1744.0859,2743.085,1740.0859,2739.085" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.1436" x="1740.0859" y="2721.3428">_identify_orphan_file_decisions()</text></g><path d="M1967.1436,2705.6191 L1967.1436,2745.6191 L2219.1436,2745.6191 L2219.1436,2715.6191 L2209.1436,2705.6191 L1967.1436,2705.6191" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2209.1436,2705.6191 L2209.1436,2715.6191 L2219.1436,2715.6191 L2209.1436,2705.6191" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.2427" x="1973.1436" y="2723.1875">Add REMOVE_FILE decisions for files</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231.3403" x="1973.1436" y="2738.498">not referenced by any playlist_tracks</text><g class="message" data-participant-1="Engine" data-participant-2="Orch"><polygon fill="#181818" points="590.6304,2775.5508,580.6304,2779.5508,590.6304,2783.5508,586.6304,2779.5508" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="584.6304" x2="1727.0859" y1="2779.5508" y2="2779.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.9814" x="596.6304" y="2774.8086">SyncDecisions</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2591.6646" x="0" y="2808.2061"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="2808.2061" y2="2808.2061"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="2811.2061" y2="2811.2061"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="195.7461" x="1197.9592" y="2797.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="177.4614" x="1203.9592" y="2814.1191">Stage 5: Execute Decisions</text><g class="message" data-participant-1="Orch" data-participant-2="Orch"><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="621.6304" y1="2852.1719" y2="2852.1719"/><line style="stroke:#181818;stroke-width:1;" x1="621.6304" x2="621.6304" y1="2852.1719" y2="2865.1719"/><line style="stroke:#181818;stroke-width:1;" x1="580.6304" x2="621.6304" y1="2865.1719" y2="2865.1719"/><polygon fill="#181818" points="590.6304,2861.1719,580.6304,2865.1719,590.6304,2869.1719,586.6304,2865.1719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224.7959" x="586.6304" y="2847.4297">_execute_decision_execution_step()</text></g><g class="message" data-participant-1="Orch" data-participant-2="Exec"><polygon fill="#181818" points="2039.8584,2890.4824,2049.8584,2894.4824,2039.8584,2898.4824,2043.8584,2894.4824" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="2045.8584" y1="2894.4824" y2="2894.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276.6182" x="586.6304" y="2889.7402">execute_decisions(decisions, target_format)</text></g><path d="M757.4009,2909.4824 L831.8477,2909.4824 L831.8477,2916.793 L821.8477,2926.793 L757.4009,2926.793 L757.4009,2909.4824" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="472.5684" style="stroke:#000000;stroke-width:1.5;" width="1824.2637" x="757.4009" y="2909.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="772.4009" y="2923.0508">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106.9492" x="846.8477" y="2922.1172">[For each decision]</text><path d="M767.4009,2933.793 L829.5396,2933.793 L829.5396,2941.1035 L819.5396,2951.1035 L767.4009,2951.1035 L767.4009,2933.793" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="441.2578" style="stroke:#000000;stroke-width:1.5;" width="1804.2637" x="767.4009" y="2933.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="782.4009" y="2947.3613">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121.0269" x="844.5396" y="2946.4277">[DOWNLOAD_TRACK]</text><g class="message" data-participant-1="Exec" data-participant-2="FS"><polygon fill="#181818" points="2504.7012,2968.4141,2514.7012,2972.4141,2504.7012,2976.4141,2508.7012,2972.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2061.8584" x2="2510.7012" y1="2972.4141" y2="2972.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.8354" x="2068.8584" y="2967.6719">Ensure playlist directory exists</text></g><g class="message" data-participant-1="Exec" data-participant-2="DB"><polygon fill="#181818" points="850.3994,2997.7246,840.3994,3001.7246,850.3994,3005.7246,846.3994,3001.7246" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="2050.8584" y1="3001.7246" y2="3001.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.7554" x="856.3994" y="2996.9824">get_track_by_id(track_id)</text></g><g class="message" data-participant-1="DB" data-participant-2="Exec"><polygon fill="#181818" points="2039.8584,3027.0352,2049.8584,3031.0352,2039.8584,3035.0352,2043.8584,3031.0352" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="2045.8584" y1="3031.0352" y2="3031.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.6177" x="846.3994" y="3026.293">track</text></g><g class="message" data-participant-1="Exec" data-participant-2="TidalDL"><polygon fill="#181818" points="2404.5625,3056.3457,2414.5625,3060.3457,2404.5625,3064.3457,2408.5625,3060.3457" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2061.8584" x2="2410.5625" y1="3060.3457" y2="3060.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.7939" x="2068.8584" y="3055.6035">Download tidal_id &#8594; target_path</text></g><g class="message" data-participant-1="TidalDL" data-participant-2="Exec"><polygon fill="#181818" points="2072.8584,3085.6563,2062.8584,3089.6563,2072.8584,3093.6563,2068.8584,3089.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="2066.8584" x2="2415.5625" y1="3089.6563" y2="3089.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.4326" x="2078.8584" y="3084.9141">file downloaded</text></g><g class="message" data-participant-1="Exec" data-participant-2="DB"><polygon fill="#181818" points="850.3994,3114.9668,840.3994,3118.9668,850.3994,3122.9668,846.3994,3118.9668" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="2050.8584" y1="3118.9668" y2="3118.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259.689" x="856.3994" y="3114.2246">add_file_path_to_track(track_id, rel_path)</text></g><g class="message" data-participant-1="Exec" data-participant-2="DB"><polygon fill="#181818" points="850.3994,3144.2773,840.3994,3148.2773,850.3994,3152.2773,846.3994,3148.2773" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="2050.8584" y1="3148.2773" y2="3148.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299.7871" x="856.3994" y="3143.5352">update_track(download_status=DOWNLOADED)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="767.4009" x2="2571.6646" y1="3157.2773" y2="3157.2773"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84.1489" x="772.4009" y="3167.9121">[REMOVE_FILE]</text><g class="message" data-participant-1="Exec" data-participant-2="DB"><polygon fill="#181818" points="850.3994,3188.543,840.3994,3192.543,850.3994,3196.543,846.3994,3192.543" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="2050.8584" y1="3192.543" y2="3192.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.7554" x="856.3994" y="3187.8008">get_track_by_id(track_id)</text></g><g class="message" data-participant-1="DB" data-participant-2="Exec"><polygon fill="#181818" points="2039.8584,3217.8535,2049.8584,3221.8535,2039.8584,3225.8535,2043.8584,3221.8535" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="839.3994" x2="2045.8584" y1="3221.8535" y2="3221.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.6177" x="846.3994" y="3217.1113">track</text></g><g class="message" data-participant-1="Exec" data-participant-2="Exec"><line style="stroke:#181818;stroke-width:1;" x1="2061.8584" x2="2103.8584" y1="3251.1641" y2="3251.1641"/><line style="stroke:#181818;stroke-width:1;" x1="2103.8584" x2="2103.8584" y1="3251.1641" y2="3264.1641"/><line style="stroke:#181818;stroke-width:1;" x1="2062.8584" x2="2103.8584" y1="3264.1641" y2="3264.1641"/><polygon fill="#181818" points="2072.8584,3260.1641,2062.8584,3264.1641,2072.8584,3268.1641,2068.8584,3264.1641" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233.854" x="2068.8584" y="3246.4219">Verify file not reused by active tracks</text></g><g class="message" data-participant-1="Exec" data-participant-2="FS"><polygon fill="#181818" points="2504.7012,3289.4746,2514.7012,3293.4746,2504.7012,3297.4746,2508.7012,3293.4746" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2061.8584" x2="2510.7012" y1="3293.4746" y2="3293.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63.7368" x="2068.8584" y="3288.7324">Delete file</text></g><g class="message" data-participant-1="Exec" data-participant-2="DB"><polygon fill="#181818" points="850.3994,3318.7852,840.3994,3322.7852,850.3994,3326.7852,846.3994,3322.7852" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="2050.8584" y1="3322.7852" y2="3322.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300.1743" x="856.3994" y="3318.043">remove_file_path_from_track(track_id, rel_path)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="767.4009" x2="2571.6646" y1="3331.7852" y2="3331.7852"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124.3086" x="772.4009" y="3342.4199">[UPDATE_METADATA]</text><g class="message" data-participant-1="Exec" data-participant-2="DB"><polygon fill="#181818" points="850.3994,3363.0508,840.3994,3367.0508,850.3994,3371.0508,846.3994,3367.0508" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="844.3994" x2="2050.8584" y1="3367.0508" y2="3367.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.397" x="856.3994" y="3362.3086">update_track(track_id, metadata)</text></g><g class="message" data-participant-1="Exec" data-participant-2="Orch"><polygon fill="#181818" points="590.6304,3406.3613,580.6304,3410.3613,590.6304,3414.3613,586.6304,3410.3613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="584.6304" x2="2055.8584" y1="3410.3613" y2="3410.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.439" x="596.6304" y="3405.6191">ExecutionResult</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="2591.6646" x="0" y="3439.0166"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="3439.0166" y2="3439.0166"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="2591.6646" y1="3442.0166" y2="3442.0166"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="80.5933" x="1255.5356" y="3428.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62.3086" x="1261.5356" y="3444.9297">Summary</text><g class="message" data-participant-1="Orch" data-participant-2="Orch"><line style="stroke:#181818;stroke-width:1;" x1="579.6304" x2="621.6304" y1="3482.9824" y2="3482.9824"/><line style="stroke:#181818;stroke-width:1;" x1="621.6304" x2="621.6304" y1="3482.9824" y2="3495.9824"/><line style="stroke:#181818;stroke-width:1;" x1="580.6304" x2="621.6304" y1="3495.9824" y2="3495.9824"/><polygon fill="#181818" points="590.6304,3491.9824,580.6304,3495.9824,590.6304,3499.9824,586.6304,3495.9824" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.4248" x="586.6304" y="3478.2402">get_summary()</text></g><g class="message" data-participant-1="Orch" data-participant-2="CLI"><polygon fill="#181818" points="200.3364,3521.293,190.3364,3525.293,200.3364,3529.293,196.3364,3525.293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="194.3364" x2="568.6304" y1="3525.293" y2="3525.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356.2939" x="206.3364" y="3520.5508">Summary (tidal, filesystem, dedup, decisions, execution)</text></g><g class="message" data-participant-1="CLI" data-participant-2="CLI"><line style="stroke:#181818;stroke-width:1;" x1="189.3364" x2="231.3364" y1="3554.6035" y2="3554.6035"/><line style="stroke:#181818;stroke-width:1;" x1="231.3364" x2="231.3364" y1="3554.6035" y2="3567.6035"/><line style="stroke:#181818;stroke-width:1;" x1="190.3364" x2="231.3364" y1="3567.6035" y2="3567.6035"/><polygon fill="#181818" points="200.3364,3563.6035,190.3364,3567.6035,200.3364,3571.6035,196.3364,3567.6035" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211.0786" x="196.3364" y="3549.8613">display_db_sync_result(summary)</text></g><g class="message" data-participant-1="CLI" data-participant-2="User"><polygon fill="#181818" points="34.1826,3592.9141,24.1826,3596.9141,34.1826,3600.9141,30.1826,3596.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="28.1826" x2="183.3364" y1="3596.9141" y2="3596.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.749" x="40.1826" y="3592.1719">&#10003; Sync complete</text></g><!--SRC=[jLZTRjis5BxNKn0PiDc5V-8uRJ83sU3MzX3CROecsoxMGM0asY4cKO8e9NMlThK7s7Qvf-kJx1nIf4XPJjjXCz26aix_pyT3VaLUP34Z1TkmWec8oLdm5NcnlYIz-9R8dOZwCoABQ5poc2PXb30ggdmS9NmSPMbAHIp7CItfBPLibE- -M3-R3DUJfsSWvAg8xfWi2rfcHQUCh61Zr33E74ebvEmP23cT30YA6gvF9b_3ykJaTBYU7f_3SdewXUNJSz1oWpAlIrgo5Ij1p65LwjLO8ccuqRHAsUGOJJvJsivEGDkp4rYU7XyFrwTdnw1YnHCcTx9awNL4XM05wLMIRjbdHcPoXgwSFWE9r-3rWaLSyaminPOBzdY0ufesP8guDXiCd9oVOJYcNqCupYVAR5W-FK6p5zc3I38QktaWlGTUiBZ_cVcOJ6n2fXYYwVaqA7cPCA9436iHf2uPyk6tlw2iqhnWTqn8Vi_8AiaUWe16QCCFaXL1JekIHpodeYH7K6zlXIsu8q8bbg17Wo7pF04QVFQ85dMyhrbnpoE6D8ld7iLUkI1DlVG8zvCEXFNIrydYAazuH4j8q3hRyaYfnRTx3lWvHpgzyWLsvGr9tx783vjoXinVNwg8gITuy6bqWk9aABODrMBj4w6pO21wguXMrq60MIB3Rp0Hi-uqOphvFOHI9Ij0q33qhsaX6SboZ8aS42vu2GKXDdnho1RFP-rqGG64EItl-eR6U3H3Ni6YqlkmME-znv3DY60FU-NIYvJs0TWUIgrky5QGk8wrVQSzXKU9UUetBgfQ2ouk21JFbf79J5SDsHHPgkqX5nS1KZM6X0nILW7SQA4AT488SjxhMqgBMlehJP8mJ-WkuRAKFKU_gT70r6qTmoqhmuJACiICWA8KFAPftZkg7O6tH_rWyPmCNMK-XoUq2NeTX54b4IaTemo9BrChj7G__n84IPRbP0NbooXuwnC417wENYidX5JTiw8CVNhGs-8mxXkAy7PNy_2uPnQQg-q_UmVqN6o_LLzfKa9teT7gyQ1XLHxZvc4jCbAWgg2IjIQMGE6_OWzTaj3Wg62U38TJnEglDUdwBgkIM1S6WJAEVksqhqcO7x2HPgdZXh_7ygQ98Mc6k2jtYiXIV6825PDZnO4iAh97KcX-xLH2GolMRpsgZfGUq5qdLLlPPCFyzlBvU5uFYgcJUu2Rnd4TW39hQiCMDey7kW1m1R2LPv8Zj2AowdXTt1GLQrGQTVWN_mNTraf1StcNbHvQ30ZEIBBVy5X0KszmzyIwZsGGitryiX1vCbFxfREJFeAG6qiKIc1gesIzyG8cuSU386dsPxDbOvrSpyWQwCXhmp0cCSn0E8bm9WdCQKGfRu6LZJqGgr0wChk0Hz2KzV0_3t2itHxgTPb7gvXdsXBIUp9Ay-c0F1bj4XeDo6Wqqb9z4v7OPjoHQPNgNHZ9q33ouVS_2ExwiXohuQsB5rtRS14txIYo8gK9VyzYxUEH5a66H0avQegkxNEhBR4bLrdLQeIMRcm4D5WD0jWCkg5iySD19Qc71Bz3iv9iFYOSSuQrimUCXmAugjw_tv6K8W3VmiPAu4FC4I_smEQb8jetuR_nqVfvLUHtq5DUwX_pu0s3iJuccM8xY4XjkB2IRAFYc-x6DptNDFvqHkQ29hltp1-E7sd_sALhDxyI0c7JClqCMZFqmAt-Dt6-53A7FjTr24qFeo2_hTH8IcXKP5BQjfI6qvhcMVw6oIefNQ-rkiRdqndvZa4Oz3SzvSj77QvFT5lDrU6sEHYwVdUYNds62EfJHQlONPQwGuraTrRhHZzL5VjoBV3fcgLIPX5NJaXtq_AWiAtKdpWQ7OOEfeWaWVI5oizcObATOPgt0nLz-RR4EnGed3CpNEqADfPreTvq-nw4tQXg4e0tNDI3_vTVgeRKKwK_SEohDTK1lRbyUVNZCbnThfTm-eKTMUBRWgNPFOkTWyM0v0M7tQhSNPotO6_Lg2KKAfqMa9vFDk3LLJX_SNDvzQf3QCfX-1TRG0uuJp7eJtJNAujFqR2u-kdL-cg-26_Up5zy3rvg2sVERZmtsyaDRYSZzgvq_9qSTyyqDlSTQUKn4oNVx48DUXfgJR-Pme7yCLBmxHtOCezZDnV4qWAS5tfBVYimuVQIB2QtE-ZBNRkO5NWQanhiT4x-7dIQnhKeydIcJldLvuA8Vj658V01Jpi-lUpPrQ2kcN23stpfeWfUDxHWmR3P8ugVtwRPWDTCDqiXguBPIDdXQzTk5yEqTo30eq2zD-uD6zh1LglNWkmjWRbH8UP4eKQXsd644_-4j5WxebLZcsi25dTQ-oysT9VTFu7O6mdORIjvOIAyN3ZdIwTQ_x_mwMy_iW9wIOT1zq0bw_fNkDm-cBgfNx24bSmVLbmpDTGveKFC-qZmbFy_l5xCRvRXo-ND71RpZqUraPQoalfdRjMpYj5ssDBqq_x6hzi2ExPAKmfLlDUU67ofFzfEDFTYXacVRGUaEVOCY9g11iHfJTlMVUzo3IOPxAOGhxBm2gTGHlPgdJKj4ECDteny-FjFXK0aoj8Syn6uxgXhBUSPR_B-0G00]--></g></svg>
